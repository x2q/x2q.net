<section id="hero">

  <!-- Animated SVG Background -->
  <svg class="hero-bg" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice">
    <defs>
      <radialGradient id="glow1" cx="50%" cy="50%" r="50%">
        <stop offset="0%" class="hero-glow-inner" />
        <stop offset="100%" class="hero-glow-outer" />
      </radialGradient>
      <radialGradient id="glow2" cx="50%" cy="50%" r="50%">
        <stop offset="0%" class="hero-glow2-inner" />
        <stop offset="100%" class="hero-glow2-outer" />
      </radialGradient>
    </defs>

    <!-- Floating orbs -->
    <circle id="orb1" cx="25%" cy="35%" r="180" fill="url(#glow1)" opacity="0.5">
      <animate attributeName="cx" values="25%;35%;20%;25%" dur="20s" repeatCount="indefinite" />
      <animate attributeName="cy" values="35%;55%;40%;35%" dur="23s" repeatCount="indefinite" />
    </circle>
    <circle id="orb2" cx="70%" cy="60%" r="220" fill="url(#glow2)" opacity="0.4">
      <animate attributeName="cx" values="70%;60%;75%;70%" dur="25s" repeatCount="indefinite" />
      <animate attributeName="cy" values="60%;35%;65%;60%" dur="19s" repeatCount="indefinite" />
    </circle>
    <circle id="orb3" cx="50%" cy="20%" r="140" fill="url(#glow1)" opacity="0.3">
      <animate attributeName="cx" values="50%;65%;40%;50%" dur="22s" repeatCount="indefinite" />
      <animate attributeName="cy" values="20%;45%;25%;20%" dur="26s" repeatCount="indefinite" />
    </circle>

    <!-- Grid lines -->
    <g class="hero-grid" opacity="0.08">
      <line x1="0" y1="25%" x2="100%" y2="25%" stroke="currentColor" stroke-width="0.5" />
      <line x1="0" y1="50%" x2="100%" y2="50%" stroke="currentColor" stroke-width="0.5" />
      <line x1="0" y1="75%" x2="100%" y2="75%" stroke="currentColor" stroke-width="0.5" />
      <line x1="25%" y1="0" x2="25%" y2="100%" stroke="currentColor" stroke-width="0.5" />
      <line x1="50%" y1="0" x2="50%" y2="100%" stroke="currentColor" stroke-width="0.5" />
      <line x1="75%" y1="0" x2="75%" y2="100%" stroke="currentColor" stroke-width="0.5" />
    </g>

    <g id="particles"></g>
    <g id="connections" opacity="0.15"></g>
    <g id="nodes"></g>
  </svg>

  <!-- Content overlay -->
  <div class="hero-content" style="opacity:0">
    <div class="hero-logo-wrap">
      <div class="hero-logo-ring">
        <div class="hero-logo-glow"></div>
        <img src="{{ .Site.Params.header.logo | relURL }}" alt="{{ .Site.Title }}" class="hero-logo-img">
      </div>
    </div>

    <h1 class="hero-title">
      <span>{{ .Site.Title }}</span>
    </h1>

    <p class="hero-subtitle">
      {{ .Site.Params.subtitle }}
    </p>

    {{ if .Site.Params.author.email }}
    <a href="mailto:{{ .Site.Params.author.email }}" class="hero-cta">
      <svg class="cta-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
      </svg>
      Get in touch
      <svg class="cta-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
      </svg>
    </a>
    {{ end }}
  </div>

  <!-- Scroll indicator -->
  <div class="hero-scroll-hint" style="opacity:0">
    <div class="scroll-pill">
      <div class="scroll-dot"></div>
    </div>
  </div>
</section>

<script>
(function() {
  const svg = document.querySelector('#hero svg');
  const nodesG = document.getElementById('nodes');
  const connsG = document.getElementById('connections');
  const particlesG = document.getElementById('particles');
  if (!svg || !nodesG) return;

  const ns = 'http://www.w3.org/2000/svg';
  const nodeCount = 18;
  const nodeData = [];
  let w = window.innerWidth;
  let h = window.innerHeight * 0.85;
  const connectionDist = 220;

  for (let i = 0; i < nodeCount; i++) {
    const x = Math.random() * w;
    const y = Math.random() * h;
    const r = 2 + Math.random() * 3;
    const vx = (Math.random() - 0.5) * 0.4;
    const vy = (Math.random() - 0.5) * 0.4;

    const circle = document.createElementNS(ns, 'circle');
    circle.setAttribute('r', r);
    circle.setAttribute('class', 'hero-node');
    circle.style.fill = 'currentColor';
    circle.style.opacity = 0.25 + Math.random() * 0.25;
    nodesG.appendChild(circle);

    nodeData.push({ x, y, vx, vy, r, el: circle });
  }

  const linePool = [];
  for (let i = 0; i < 40; i++) {
    const line = document.createElementNS(ns, 'line');
    line.setAttribute('stroke', 'currentColor');
    line.setAttribute('stroke-width', '0.5');
    line.style.display = 'none';
    connsG.appendChild(line);
    linePool.push(line);
  }

  function spawnParticle() {
    const p = document.createElementNS(ns, 'circle');
    p.setAttribute('cx', Math.random() * w);
    p.setAttribute('cy', h + 10);
    p.setAttribute('r', 1 + Math.random());
    p.style.fill = 'currentColor';
    p.style.opacity = 0.15;
    p.classList.add('hero-particle');
    const dur = 6 + Math.random() * 8;
    p.style.animationDuration = dur + 's';
    particlesG.appendChild(p);
    setTimeout(() => p.remove(), dur * 1000);
  }

  let animId;
  function tick() {
    for (const n of nodeData) {
      n.x += n.vx;
      n.y += n.vy;
      if (n.x < -20) n.x = w + 20;
      if (n.x > w + 20) n.x = -20;
      if (n.y < -20) n.y = h + 20;
      if (n.y > h + 20) n.y = -20;
      n.el.setAttribute('cx', n.x);
      n.el.setAttribute('cy', n.y);
    }

    let li = 0;
    for (let i = 0; i < nodeData.length && li < linePool.length; i++) {
      for (let j = i + 1; j < nodeData.length && li < linePool.length; j++) {
        const dx = nodeData[i].x - nodeData[j].x;
        const dy = nodeData[i].y - nodeData[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < connectionDist) {
          const line = linePool[li++];
          line.setAttribute('x1', nodeData[i].x);
          line.setAttribute('y1', nodeData[i].y);
          line.setAttribute('x2', nodeData[j].x);
          line.setAttribute('y2', nodeData[j].y);
          line.style.opacity = (1 - dist / connectionDist) * 0.4;
          line.style.display = '';
        }
      }
    }
    for (let k = li; k < linePool.length; k++) {
      linePool[k].style.display = 'none';
    }

    animId = requestAnimationFrame(tick);
  }

  tick();

  const particleInterval = setInterval(spawnParticle, 600);

  const observer = new IntersectionObserver(([entry]) => {
    if (entry.isIntersecting) {
      if (!animId) tick();
    } else {
      cancelAnimationFrame(animId);
      animId = null;
    }
  }, { threshold: 0.1 });
  observer.observe(document.getElementById('hero'));

  document.getElementById('hero').addEventListener('mousemove', (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const mx = (e.clientX - rect.left) / rect.width - 0.5;
    const my = (e.clientY - rect.top) / rect.height - 0.5;

    const orb1 = document.getElementById('orb1');
    const orb2 = document.getElementById('orb2');
    const orb3 = document.getElementById('orb3');
    if (orb1) orb1.style.transform = `translate(${mx * 30}px, ${my * 30}px)`;
    if (orb2) orb2.style.transform = `translate(${mx * -20}px, ${my * -20}px)`;
    if (orb3) orb3.style.transform = `translate(${mx * 15}px, ${my * 15}px)`;
  });

  window.addEventListener('resize', () => {
    w = window.innerWidth;
    h = window.innerHeight * 0.85;
  });

  window.addEventListener('beforeunload', () => {
    cancelAnimationFrame(animId);
    clearInterval(particleInterval);
    observer.disconnect();
  });
})();
</script>
